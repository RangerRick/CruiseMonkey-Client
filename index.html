<!doctype html>
<!-- paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/ -->
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en" manifest="cruisemonkey.manifest"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en" manifest="cruisemonkey.manifest"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en" manifest="cruisemonkey.manifest"> <![endif]-->
<!--[if gt IE 8]><!-->
<!-- manifest="cruisemonkey.manifest" -->
<html xmlns:ng="http://angularjs.org" lang="en" manifest="cruisemonkey.manifest">
<!--<![endif]-->
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
<style>
	[ng-cloak] {
		display: none;
	}
</style>
<link rel="stylesheet" href="css/3rdparty/normalize.css" />
<link rel="stylesheet" href="css/angular-mobile-frame.min.css" />
<link rel="stylesheet" href="css/cruisemonkey/cruisemonkey.css" />
<script src="js/3rdparty/custom.modernizr.js"></script>
<!-- IE Fix for HTML5 Tags -->
<!--[if lt IE 9]>
		<script src="js/3rdparty/html5shiv.js"></script>
	<![endif]-->
<!-- <script src="js/3rdparty/jquery.js"></script> -->
<script src="js/3rdparty/script.js"></script>
<script src="js/angular/angular-loader.js"></script>
<script>
window.addEventListener('load', function(e) {
	window.applicationCache.addEventListener('updateready', function(e) {
		if (window.applicationCache.status == window.applicationCache.UPDATEREADY) {
			// Browser downloaded a new app cache.
			// Swap it in and reload the page to get the new hotness.
			console.log('a new version is available; reloading');
			window.applicationCache.swapCache();
			window.location.reload();
		}
	}, false);
}, false);

window.setInterval(function() {
	window.applicationCache.update();
}, 5000);

// load all of the dependencies asynchronously.
$script([
	'js/3rdparty/jquery.js',
	'js/3rdparty/fastclick.js',
	'js/3rdparty/hammer.min.js',
	'js/3rdparty/pouchdb-nightly.min.js',
	'js/log4javascript/log4javascript.js'
], '3rdparty', function() {
	console.log('standalone 3rd party scripts loaded.');
});

$script([
	'js/angular/angular.min.js'
], 'angular-core', function() {
	console.log('AngularJS Core loaded.');

	$script([
		'js/angular/angular-route.min.js'
	], 'angular-core', function() {
		console.log('AngularJS Core loaded.');

		$script([
			'js/angular/angular-mobile-frame.min.js',
			'js/angular/angular-phonegap-ready.js',
			'js/angular/angular-resource.min.js',
			/* 'js/angular/angular-strap.min.js', */
			'js/angular/angular-hammer.js',
			'js/angular/angularls.js'
		], 'angular-addons', function() {
			console.log('AngularJS (and 3rd-party addons) loaded.');
		});
	});
});

$script.ready(['3rdparty', 'angular-core', 'angular-addons'], function() {
	$script([
		'js/cruisemonkey/string.js',
		'js/cruisemonkey/offcanvas.js',
		'js/cruisemonkey/Config.js',
		'js/cruisemonkey/Logging.js',
		'js/cruisemonkey/Database.js',
		'js/cruisemonkey/Navigation.js',
		'js/cruisemonkey/Events.js',
		'js/cruisemonkey/services.js',
		'js/cruisemonkey/factories.js',
		'js/cruisemonkey/controllers.js',
		'js/cruisemonkey/filters.js',
		'js/cruisemonkey/directives.js',
		'js/cruisemonkey/main.js'
	], 'cruisemonkey', function() {
		console.log('CruiseMonkey loaded.');
		new FastClick(document.body);
		angular.bootstrap(document, ['cruisemonkey']);
	});
});

var timeoutID;

document.addEventListener("deviceready", function() {
	if (timeoutID) {
		window.clearTimeout(timeoutID);
	}
}, false);

timeoutID = window.setTimeout(function() {
	console.log('Firing deviceready manually.');
	window.clearTimeout(timeoutID);
	var e = document.createEvent('Events');
	e.initEvent('deviceready');
	document.dispatchEvent(e);
}, 2000);
  </script>
  <title ng-bind="'CruiseMonkey - ' + $root.title">CruiseMonkey</title>
</head>
<body class="antialiased off-canvas hide-extras" ng-cloak>
	<mobile-frame>
		<mobile-header ng-controller="CMHeaderCtrl">
			<span class="title"><strong>{{title}}</strong></span>
			<span class="actions" ng-repeat="action in actions">
				<div class="icon icon-{{action.iconClass}}"></div>
			</span>
		</mobile-header>
		<mobile-nav ng-controller="CMNavigationCtrl">
			<ul class="nav">
				<li class="sidebar-header">CruiseMonkey</li>
				<li data-match-route="/events/official"   ><a href="#/events/official"   >Official Events</a></li>
				<li data-match-route="/events/unofficial" ><a href="#/events/unofficial" >Unofficial Events</a></li>
				<li data-match-route="/events/my"         ><a href="#/events/my"         >My Events</a></li>
				<li data-match-route="/deck-plans"        ><a href="#/deck-plans"        >Deck Plans</a></li>
			</ul>
		</mobile-nav>
		<mobile-content ng-view></mobile-content>
	</mobile-frame>
</body>
</html>
